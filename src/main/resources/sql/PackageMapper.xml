<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.happytravel.btoc.dao.PackageDao">

    <!-- 전체 패키지 목록 조회 -->
    <select id="getCountByCountry" resultType="kr.happytravel.btoc.dto.CntPerCountryList"
            parameterType="hashmap">
        SELECT
        c.COUNTRY_CODE,
        c.KOREAN_NAME,
        c.COUNTRY_IMAGE,
        COUNT(p.PACKAGE_CODE) AS PACKAGE_COUNT
        FROM
        TB_COUNTRY_INFO c
        JOIN
        TB_PACKAGE_INFO p ON c.COUNTRY_CODE = p.COUNTRY_CODE
        WHERE
        c.COUNTRY_IMAGE IS NOT NULL
        AND p.ASSIGN_CODE = '2000'
        AND p.IS_USED = 'Y'
        GROUP BY
        c.COUNTRY_CODE, c.KOREAN_NAME, c.COUNTRY_IMAGE
        ORDER BY
        c.COUNTRY_CODE
    </select>

    <!-- 전체 패키지 목록 조회 -->
    <select id="getTop5Package" resultType="kr.happytravel.btoc.dto.Top5Package"
            parameterType="hashmap">
        SELECT
        p.PACKAGE_CODE,
        p.PACKAGE_NAME,
        c.COUNTRY_IMAGE,
        p.PACKAGE_INFO,
        p.SALE_AMOUNT,
        p.SALE_PRICE,
        DATEDIFF(p.END_DATE, p.START_DATE) AS days,
        c.KOREAN_NAME as countryName,
        h.REGION,
        p.RATING
        FROM
        TB_PACKAGE_INFO p
        JOIN
        TB_COUNTRY_INFO c ON p.COUNTRY_CODE = c.COUNTRY_CODE
        JOIN
        TB_HOTEL_INFO h ON p.HOTEL_CODE = h.HOTEL_CODE
        WHERE
        c.COUNTRY_IMAGE IS NOT NULL
        AND p.ASSIGN_CODE = '2000'
        AND p.IS_USED = 'Y'
        ORDER BY
        p.SALE_AMOUNT DESC
        LIMIT 5
    </select>

    <select id="getPackageList" resultType="kr.happytravel.btoc.dto.PackageDTO" parameterType="hashmap">
        SELECT
        p.PACKAGE_CODE,
        p.PACKAGE_NAME,
        c.COUNTRY_IMAGE,
        p.PACKAGE_INFO,
        p.SALE_AMOUNT,
        p.SALE_PRICE,
        DATEDIFF(p.END_DATE, p.START_DATE) AS days,
        c.KOREAN_NAME as countryName,
        h.REGION,
        p.RATING
        FROM
        TB_PACKAGE_INFO p
        JOIN
        TB_COUNTRY_INFO c ON p.COUNTRY_CODE = c.COUNTRY_CODE
        JOIN
        TB_HOTEL_INFO h ON p.HOTEL_CODE = h.HOTEL_CODE
        WHERE
        c.COUNTRY_IMAGE IS NOT NULL
        AND p.ASSIGN_CODE = '2000'
        AND p.IS_USED = 'Y'
        <if test="country != null">
            AND c.KOREAN_NAME LIKE CONCAT('%', #{country}, '%')
        </if>
        <if test="region != null">
            AND h.REGION LIKE CONCAT('%', #{region}, '%')
        </if>
        <if test="packageName != null">
            AND p.PACKAGE_NAME LIKE CONCAT('%', #{packageName}, '%')
        </if>
        <if test="dateFrom != null and dateTo != null">
            AND p.START_DATE &gt;= #{dateFrom}
            AND p.END_DATE &lt;= #{dateTo}
        </if>
        <if test="minSalePrice != null and maxSalePrice != null">
            AND p.SALE_PRICE BETWEEN #{minSalePrice} AND #{maxSalePrice}
        </if>
        ORDER BY
        p.SALE_AMOUNT DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- 전체 목록 카운트 -->
    <select id="getPackageCnt" resultType="int" parameterType="hashmap">
        SELECT COUNT(package_code)
        FROM TB_PACKAGE_INFO
        WHERE
        AND IS_USED != 'N'
        AND ASSIGN_CODE = 2000
        <if test="packageName != null and packageName != ''">
            AND PACKAGE_NAME LIKE CONCAT('%', #{packageName}, '%')
        </if>
    </select>

    <!-- 단건 조회 -->


    <!-- INSERT 쿼리 -->


    <!-- UPDATE 쿼리 -->




</mapper>